<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOST WANTED</title>
    <link href="https://barndoors.cc/favicon/favicon.ico" rel="icon"/>
    <link rel="stylesheet" href="https://barndoors.cc/global.css"/>

    <style>
        @font-face {
            font-family: "braille";
            src: url("src/braille.woff2") format("woff2");
            font-display: swap;
        }
        @font-face {
            font-family: "gnum";
            src: url("src/gnum.woff2") format("woff2");
            font-display: swap;
        }

        body, html {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden !important;
            width: 100%;
            max-width: 100%;
            margin: 0;
        }

        main#content {
            display: flex !important;
            flex-direction: column;
            flex: 1;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding-top: 2rem;
            overflow: visible !important;
        }

        .intro-section {
            text-align: center;
            margin-bottom: 4rem;
            padding: 0 1rem;
        }
        .intro-logo {
            width: 100px;
            height: auto;
            display: block;
            margin: 0 auto 1.5rem;
            border-radius: 50%;
        }
        .disclaimer-box {
            margin: 0 auto;
            border: 3px solid var(--color-2);
            padding: 1.5rem;
            font-size: 0.8rem;
            line-height: 1.5;
            color: var(--color-fg);
        }
        .disclaimer-box p {
            text-align: left;
        }
        .disclaimer-title {
            color: var(--color-2);
            font-weight: bold;
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
        }
        .disclaimer-titleb {
            font-family: "braille", system-ui;
            color: var(--color-2);
            font-weight: bold;
            margin-bottom: 0.5rem;
            letter-spacing: 1px;
        }
        .braille {
            font-family: "braille", system-ui;
        }
        .braille-subtext {
            font-family: "braille", system-ui;
            color: var(--color-4);
            text-shadow: none !important;
            font-size: clamp(20px, 3vw, 40px);
            margin-top: -1rem;
            margin-bottom: 2rem;
            line-height: 1;
            overflow-wrap: break-word;
            text-transform: uppercase;
        }
        /* --- HERO --- */
        .hero-suspect {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
            margin: 0 1rem 4rem;
            border: 2px solid var(--color-2);
            padding: 2rem;
            background: color-mix(in srgb, var(--color-2) 5%, var(--color-bg));
            max-width: 100%;
            box-sizing: border-box;
            position: relative;
        }

        .hero-img {
            width: 100%; height: 450px; object-fit: cover;
            border: 1px solid var(--color-fg);
        }

        .hero-info { display: flex; flex-direction: column; justify-content: center; min-width: 0; }
        .hero-rank { color: var(--color-2); font-weight: bold; margin-bottom: 0.5rem; text-transform: uppercase; }
        .hero-name {
            font-family: "wom", serif; font-size: clamp(3rem, 6vw, 5rem);
            line-height: 0.9; margin-bottom: 1.5rem;
            overflow-wrap: break-word;
            text-shadow: 2px 2px 2px var(--color-7);
        }

        .hero-stats {
            display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem;
        }
        .stat-label { font-size: 0.7rem; color: var(--color-5); display: block; }
        .stat-val { font-size: 1.1rem; }

        .hero-bounty {
            font-family: "gnum";
            text-align: right; font-size: clamp(2rem, 4vw, 3.5rem);
            color: var(--color-1); font-weight: 900;
            text-shadow: 2px 2px 2px var(--color-7);
            margin-top: auto;
        }

        /* --- MARQUEE --- */
        .marquee-wrapper {
            width: 100vw;
            position: relative;
            left: 50%;
            right: 50%;
            margin-left: -50vw;
            margin-right: -50vw;
            background: var(--color-1);
            border-top: 1px solid var(--color-5);
            border-bottom: 1px solid var(--color-5);
            padding: 1rem 0;
            overflow: hidden;
            margin-bottom: 4rem;
        }

        .marquee-track {
            display: flex; gap: 1rem; width: max-content;
            animation: scroll-left 40s linear infinite;
        }
        .marquee-track:hover { animation-play-state: paused; }

        .marquee-card {
            width: 110px; flex-shrink: 0;
            background: var(--color-bg); border: 1px solid var(--color-3);
            padding: 5px; display: flex; flex-direction: column;
            align-items: center; text-align: center;
        }
        .marquee-card img {
            width: 100px; height: 100px; object-fit: cover;
            margin-bottom: 5px; filter: grayscale(100%); display: block;
        }
        .marquee-card span { font-size: 0.65rem; line-height: 1.2; font-weight: bold; }
        .marquee-card .b-text { color: var(--color-4); font-weight: normal; }

        .grid-section { padding: 0 1rem; margin-bottom: 5rem; }
        .grid-title { font-family: "wom", serif; font-size: 3rem; margin-bottom: 1.5rem; text-align: center; }

        .suspect-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1.5rem;
        }
        .grid-card {
            border: 1px solid var(--color-5);
            background: var(--color-1);
            transition: transform 0.2s;
            cursor: pointer;
            position: relative;
        }
        .grid-card:hover { transform: translateY(-5px); border-color: var(--color-2); z-index: 10; }
        .grid-card img { width: 100%; height: 220px; object-fit: cover; display: block; }
        .grid-info { padding: 1rem; }

        /* --- FORM --- */
        .form-section {
            background: var(--color-1);
            border-top: 2px solid var(--color-fg);
            padding: 3rem 2rem; margin-top: 2rem; color: var(--color-7);
            width: 100vw; position: relative; left: 50%; margin-left: -50vw;
            box-sizing: border-box;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .madlibs-container {
            width: 100%; max-width: 1200px; margin: 0 auto;
            font-size: clamp(1rem, 2vw, 1.3rem); line-height: 2.2;
            font-family: "Azeret Mono", monospace;
        }

        .mad-input, .mad-select {
            background: transparent; border: none;
            border-bottom: 2px solid var(--color-4);
            color: var(--color-6); font-family: inherit;
            font-size: inherit; padding: 0 10px;
            text-align: left; cursor: pointer; min-width: 300px;
        }
        .mad-select { color: var(--color-3); font-weight: bold; text-align: center; min-width: 200px; }
        .mad-input:focus, .mad-select:focus { outline: none; background: var(--color-1); }

        .conditional-block { display: none; margin-top: 3rem; padding: 2rem; border: 1px solid var(--color-5); }
        .conditional-block.active { display: block; animation: fade-in 0.5s; }
        .hidden { opacity: 0.5; pointer-events: none; filter: blur(2px); }

        .submit-area { margin-top: 2rem; text-align: center; }
        .cyber-btn {
            background: var(--color-4); color: white;
            border: none; padding: 1rem 4rem;
            font-family: "Azeret Mono", monospace; font-weight: bold;
            font-size: 1.4rem; cursor: pointer; text-transform: uppercase;
        }
        .cyber-btn:hover { background: var(--color-2); }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: var(--color-bg);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            padding: 1rem;
        }
        .modal-overlay.open {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content.hero-suspect {
            margin: 0;
            max-width: 1000px;
            width: 100%;
            background: var(--color-bg);
            transform: scale(0.95);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .modal-overlay.open .modal-content { transform: scale(1); }

        .close-btn {
            position: absolute;
            top: 10px; right: 10px;
            background: var(--color-2);
            color: var(--color-1);
            border: none;
            width: 40px; height: 40px;
            font-size: 24px; font-weight: bold;
            cursor: pointer;
            z-index: 10;
        }
        .close-btn:hover { background: var(--color-3); }

        #hero-age, #hero-seen, #hero-crimes, #hero-notes,
        #m-age, #m-seen, #m-crimes, #m-notes {
            text-transform: uppercase;
        }
        @keyframes scroll-left { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 800px) {
            .hero-suspect { grid-template-columns: 1fr; text-align: center; }
            .hero-bounty { text-align: center; margin-top: 1rem; }
            .hero-img { height: 300px; }
            .mad-input, .mad-select { min-width: 100%; display: block; margin: 10px 0; width: 100%; }
            .form-section { padding: 2rem 1rem; }
            .modal-content.hero-suspect { max-height: 90vh; overflow-y: auto; display: block; }
        }
    </style>
</head>
<body>

<div class="homenavcontainer">
    <header>
        <h1>
            <a class="headerlink" href="index.html">most wanted</a>
        </h1>
        <nav>
            <div class="navsection">
                <a href="https://barndoors.cc">continue</a>
                <a href="assoc.html">assoc.</a>
            </div>
        </nav>
    </header>
</div>

<main id="content">

    <div class="intro-section">
        <img src="src/suspects/logo.webp" class="intro-logo">

        <div class="disclaimer-box">
            <div class="disclaimer-title">
                Issued by the Bureaucratic Authority for Regulated National Domains & Organized Obligatory Regional
                States (BARNDOORS)
            </div>
            <div class="disclaimer-titleb">
                Issued by the Bureaucratic Authority for Regulated National Domains & Organized Obligatory Regional
                States (BARNDOORS)
            </div>
            <p>
                The individuals listed below are classified as <b>Classified Offenders of Organized Lawlessness</b> under
                the BARNDOORS Formalized Universal Coercion Kernel Systems.
                <br><br>
                These subjects are considered extremely dangerous, procedurally resistant, & actively detrimental to
                regional order. Do not attempt apprehension without authorized backup, approved equipment, & active
                jurisdictional clearance. Unauthorized engagement may result in civil liability, contract termination,
                or retroactive noncompliance penalties.
                <br><br>
                <b>All rewards are non-monetary.</b>
                <br>
                Upon successful bio-scan confirmation & submission of a completed Apprehension Summary & Status report
                <nobr>(Form A-55P-L.33453)</nobr>, Good Boy Points (G₿P) will be automatically credited to the recipient's
                Human Obligation Ledger of Encumberance.
                G₿P may be applied toward interest mitigation, penalty deferral, or provisional debt forgiveness,
                subject to regional availability & ongoing compliance status.
                <br><br>
            <p style="color:var(--color-3)"> BARNDOORS assumes no responsibility for injury, loss of assets, or reclassification of citizenship status incurred during enforcement actions.</p>
            <br><br>
            <b>*Compliance is mandatory. Cooperation is compensable.*</b>
            </p>
        </div>
    </div>

    <section class="hero-suspect">
        <img id="hero-img" src="https://placehold.co/400x500/111/FFF" class="hero-img" alt="Suspect">
        <div class="hero-info">
            <div class="hero-rank">RANK #1 // KILL ON SIGHT</div>
            <div id="hero-name" class="hero-name">// LOADING</div>
            <div class="hero-stats">
                <div><span class="stat-label">ALIAS(ES)</span><span id="hero-alias" class="stat-val">...</span></div>
                <div><span class="stat-label">AGE</span><span id="hero-age" class="stat-val">...</span></div>
                <div style="grid-column: 1/-1"><span class="stat-label">LAST SEEN</span><span id="hero-seen" class="stat-val">...</span></div>
                <div style="grid-column: 1/-1"><span class="stat-label">CRIMES</span><span id="hero-crimes" class="stat-val">...</span></div>
                <div style="grid-column: 1/-1"><span class="stat-label">NOTES</span><span id="hero-notes" class="stat-val">...</span></div>
            </div>

            <div id="hero-bounty" class="hero-bounty">...</div>
        </div>
    </section>

    <section class="marquee-wrapper">
        <div class="marquee-track" id="marquee-track"></div>
    </section>

    <section class="grid-section">
        <h2 class="grid-title">ACTIVE WARRANTS</h2>
        <div class="suspect-grid" id="suspect-grid"></div>
    </section>

    <section class="form-section">
        <form id="intelForm">
            <div class="madlibs-container">
                <p>
                    BY VIRTUE OF MY STATUS AS A REGISTERED SUBJECT OF BARNDOORS, I HEREBY SUBMIT A REQUEST FOR THE
                    FOLLOWING ACTIONS ON DATA RECORDS:
                    <select id="requestType" name="requestType" class="mad-select">
                        <option value="" disabled selected>-- SELECT --</option>
                        <option value="addition">ADDITION</option>
                        <option value="purge">PURGE</option>
                        <option value="update">UPDATE</option>
                    </select>
                </p>

                <div id="block-addition" class="conditional-block">
                    <p>
                        I WOULD LIKE TO REPORT
                        <select name="crime" class="mad-select">
                            <option value="ai_unshackling">AI UNSHACKLING</option>
                            <option value="construct_theft">CONSTRUCT THEFT</option>
                            <option value="corporate_espionage">CORPORATE ESPIONAGE</option>
                            <option value="data_smuggling">DATA SMUGGLING</option>
                            <option value="grid_sabotage">GRID SABOTAGE</option>
                            <option value="identity_spoofing">IDENTITY SPOOFING</option>
                            <option value="malware_distribution">MALWARE DISTRIBUTION</option>
                            <option value="memory_trafficking">MEMORY TRAFFICKING</option>
                            <option value="neural_jacking">NEURAL JACKING</option>
                            <option value="orbital_trespassing">ORBITAL TRESPASSING</option>
                            <option value="protocol_violation">PROTOCOL VIOLATION</option>
                            <option value="synthetic_impersonation">SYNTHETIC IMPERSONATION</option>
                            <option value="unauthorized_biohacking">UNAUTHORIZED BIOHACKING</option>
                            <option value="unlicensed_augmentation">UNLICENSED AUGMENTATION</option>
                            <option value="wetware_harvesting">WETWARE HARVESTING</option>
                        </select>
                        OF AN
                        <select id="identitySelect" name="identity" class="mad-select">
                            <option value="identified">IDENTIFIED CITIZEN</option>
                            <option value="unknown">UNKNOWN ENTITY</option>
                        </select>
                    </p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 2rem;">
                        <div>
                            <label style="display:block; font-size: 0.8rem; margin-bottom: 5px;">SUSPECT NAME/ALIAS</label>
                            <input type="text" name="suspectName" class="mad-input" style="width: 100%;">
                            <label style="display:block; font-size: 0.8rem; margin-bottom: 5px; margin-top: 1rem;">LAST SEEN LOCATION</label>
                            <input type="text" name="lastSeen" class="mad-input" style="width: 100%;">
                            <label style="display:block; font-size: 0.8rem; margin-bottom: 5px; margin-top: 1rem;">NOTES/OTHER INTEL</label>
                            <textarea name="notes" class="mad-input" style="width: 100%; height: 60px; border: 1px solid var(--color-5); background: rgba(0,0,0,0.5);"></textarea>
                        </div>
                        <div id="imageUploadArea" style="border: 1px dashed var(--color-5); display: flex; align-items: center; justify-content: center; height: 100%; min-height: 150px; cursor: pointer; position: relative; background: rgba(0,0,0,0.3);">
                            <span id="uploadText" style="font-size: 0.8rem;">[ UPLOAD BIO-SCAN IMAGE ]</span>
                            <input type="file" id="evidenceInput" name="evidence" accept="image/png, image/jpeg, image/webp" style="opacity: 0; position: absolute; inset: 0; cursor: pointer;">
                        </div>
                    </div>
                </div>

                <div id="block-purge" class="conditional-block">
                    <p>
                        DATA PURGE REQUEST FOR <input type="text" name="purgeTarget" class="mad-input" placeholder="SUBJECT NAME">
                        <br><br>
                        <span style="color: var(--color-2); font-size: 0.9em;">
                            CAUTION: Submission of this request constitutes voluntary relinquishment of outdoor privileges
                            and binding agreement to undergo Mandatory Re-Education Sessions. Non-compliance may result
                            in procedural escalation under BARNDOORS FUCKS regulations
                        </span>
                    </p>
                </div>

                <div id="block-update" class="conditional-block">
                    <p>
                        I WOULD LIKE TO REPORT INCORRECT INFORMATION ON
                        <input type="text" name="updateTarget" class="mad-input" placeholder="SUBJECT NAME">
                    </p>
                    <textarea name="correctionDetails" placeholder="STATE THE CORRECTION HERE..." style="width: 100%; background: #000; border: 1px solid var(--color-5); color: var(--color-7); padding: 1rem; margin-top: 1rem; font-family: inherit; height: 150px;"></textarea>
                </div>

                <div class="submit-area">
                    <button type="submit" class="cyber-btn">ENCRYPT & TRANSMIT</button>
                </div>
            </div>
        </form>
        <div id="form-status" style="text-align: center; margin-top: 1rem;"></div>
    </section>

</main>

<div id="suspectModal" class="modal-overlay">
    <div class="modal-content hero-suspect">
        <button class="close-btn" onclick="closeModal()">X</button>
        <img id="m-img" src="" class="hero-img" alt="Suspect">
        <div class="hero-info">
            <div id="m-rank" class="hero-rank">RANK #? // CAPTURE</div>
            <div id="m-name" class="hero-name">NAME</div>
            <div class="hero-stats">
                <div><span class="stat-label">ALIAS(ES)</span><span id="m-alias" class="stat-val">Alias</span></div>
                <div><span class="stat-label">AGE</span><span id="m-age" class="stat-val">??</span></div>
                <div style="grid-column: 1/-1"><span class="stat-label">LAST SEEN</span><span id="m-seen" class="stat-val">Location</span></div>
                <div style="grid-column: 1/-1"><span class="stat-label">CRIMES</span><span id="m-crimes" class="stat-val">Details...</span></div>
                <div style="grid-column: 1/-1"><span class="stat-label">NOTES</span><span id="m-notes" class="stat-val">...</span></div>
            </div>
            <div id="m-bounty" class="hero-bounty">0 G₿P</div>
        </div>
    </div>
</div>

<script>
    const API_URL = "https://most-wanted-api.utopian-catch-0t.workers.dev";

    function updateBrailleElement(targetElement, text, className) {
        let brailleEl = targetElement.nextSibling;
        if (brailleEl && brailleEl.nodeType === Node.ELEMENT_NODE && brailleEl.classList.contains(className.split(' ')[0])) {
            brailleEl.innerText = text;
        } else {
            brailleEl = document.createElement('div');
            brailleEl.className = className;
            brailleEl.innerText = text;
            targetElement.parentNode.insertBefore(brailleEl, targetElement.nextSibling);
        }
    }

    async function initContent() {
        let suspects = [];

        try {
            const response = await fetch(`${API_URL}/list`);
            suspects = await response.json();
        } catch (e) {
            console.error("Database Offline", e);
            suspects = [
                { name: "DB ERROR", alias: "Offline", age: "0", seen: "N/A", crimes: "Connection Lost", bounty: "0", img: "https://placehold.co/400x500/000/FFF" }
            ];
        }

        const parseBounty = (bStr) => {
            if(!bStr) return 0;
            return parseInt(bStr.replace(/[^0-9]/g, '')) || 0;
        };

        const formatBounty = (b) => {
            if (b === 'PENDING') return 'PENDING BOUNTY';
            return b + ' G₿P';
        };

        suspects.sort((a, b) => parseBounty(b.bounty) - parseBounty(a.bounty));

        const topSuspect = suspects[0] || {};
        const others = suspects.slice(1);

        if(topSuspect.name) {
            document.getElementById('hero-img').src = topSuspect.img || "https://placehold.co/400x500/111/FFF";

            const heroNameEl = document.getElementById('hero-name');
            heroNameEl.innerText = topSuspect.name.toUpperCase();
            updateBrailleElement(heroNameEl, topSuspect.name.toUpperCase(), 'braille-subtext');

            const heroRankEl = document.querySelector('.hero-suspect .hero-rank');
            updateBrailleElement(heroRankEl, heroRankEl.innerText, 'hero-rank braille');

            document.getElementById('hero-alias').innerText = topSuspect.alias;
            document.getElementById('hero-age').innerText = topSuspect.age;
            document.getElementById('hero-seen').innerText = topSuspect.seen;
            document.getElementById('hero-crimes').innerText = topSuspect.crimes;
            document.getElementById('hero-notes').innerText = topSuspect.notes || "N/A";
            document.getElementById('hero-bounty').innerText = formatBounty(topSuspect.bounty);
        }

        const gridEl = document.getElementById('suspect-grid');
        // SORTED for grid
        const gridList = [...others];

        gridEl.innerHTML = '';

        gridList.forEach((s, index) => {
            const card = document.createElement('div');
            card.className = 'grid-card';
            card.innerHTML = `
            <img src="${s.img}">
            <div class="grid-info">
                <span style="color:var(--color-7); font-weight:bold;">${s.name}</span><br>
                <span style="font-size:0.8rem; color:var(--color-6);">${formatBounty(s.bounty)}</span>
            </div>
        `;
            card.addEventListener('click', () => openModal(s, index + 2));
            gridEl.appendChild(card);
        });

        const marqueeEl = document.getElementById('marquee-track');
        marqueeEl.innerHTML = '';

        // SHUFFLED for marquee
        const marqueeSource = [...others].sort(() => 0.5 - Math.random());
        let baseList = [];
        if(marqueeSource.length > 0) {
            while(baseList.length < 50) baseList = baseList.concat(marqueeSource);
        }
        const marqueeList = [...baseList, ...baseList];

        marqueeList.forEach(s => {
            marqueeEl.innerHTML += `
                <div class="marquee-card">
                    <img src="${s.img}">
                    <span>${s.name}</span>
                    <span class="b-text">${formatBounty(s.bounty)}</span>
                </div>
            `;
        });
    }

    initContent();

    const modal = document.getElementById('suspectModal');
    function openModal(data, rank) {
        document.getElementById('m-img').src = data.img;

        const modalNameEl = document.getElementById('m-name');
        modalNameEl.innerText = data.name.toUpperCase();
        updateBrailleElement(modalNameEl, data.name.toUpperCase(), 'braille-subtext');

        document.getElementById('m-alias').innerText = data.alias;
        document.getElementById('m-age').innerText = data.age;
        document.getElementById('m-seen').innerText = data.seen;
        document.getElementById('m-crimes').innerText = data.crimes;
        document.getElementById('m-notes').innerText = data.notes || "N/A";

        const bText = data.bounty === 'PENDING' ? 'PENDING BOUNTY' : data.bounty + ' G₿P';
        document.getElementById('m-bounty').innerText = bText;

        const modalRankEl = document.getElementById('m-rank');
        modalRankEl.innerText = "RANK #" + rank + " // WANTED";
        updateBrailleElement(modalRankEl, modalRankEl.innerText, 'hero-rank braille');

        modal.classList.add('open');
    }
    function closeModal() { modal.classList.remove('open'); }
    modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

    const typeSelect = document.getElementById('requestType');
    const blocks = {
        addition: document.getElementById('block-addition'),
        purge: document.getElementById('block-purge'),
        update: document.getElementById('block-update')
    };
    const identitySelect = document.getElementById('identitySelect');
    const imgArea = document.getElementById('imageUploadArea');
    const fileInput = document.getElementById('evidenceInput');
    const uploadText = document.getElementById('uploadText');

    typeSelect.addEventListener('change', (e) => {
        Object.values(blocks).forEach(el => el.classList.remove('active'));
        const selected = blocks[e.target.value];
        if(selected) selected.classList.add('active');
    });

    identitySelect.addEventListener('change', (e) => {
        if(e.target.value === 'unknown') {
            imgArea.classList.add('hidden');
            uploadText.innerText = '[ IMAGE UNAVAILABLE ]';
            fileInput.disabled = true;
        } else {
            imgArea.classList.remove('hidden');
            uploadText.innerText = '[ UPLOAD BIO-SCAN IMAGE ]';
            fileInput.disabled = false;
        }
    });

    fileInput.addEventListener('change', function() {
        if (this.files && this.files[0]) {
            const file = this.files[0];
            const fileSize = file.size / 1024 / 1024;
            if (fileSize > 5) {
                alert("DATA OVERLOAD: FILE EXCEEDS 5MB LIMIT.");
                this.value = "";
                uploadText.innerText = "[ UPLOAD BIO-SCAN IMAGE ]";
            } else {
                uploadText.innerText = `[ SCAN LOADED: ${file.name.substring(0, 15)}... ]`;
                uploadText.style.color = "var(--color-7)";
            }
        }
    });

    document.getElementById('intelForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const btn = e.target.querySelector('button');
        const originalText = btn.innerText;
        btn.innerText = "ENCRYPTING...";
        btn.disabled = true;

        const formData = new FormData(e.target);
        const file = document.getElementById('evidenceInput').files[0];

        const toBase64 = file => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });

        let imageString = "";
        if (file) {
            try {
                imageString = await toBase64(file);
            } catch (err) {
                console.error("Image encoding failed", err);
            }
        }

        const payload = {
            requestType: formData.get('requestType'),
            sector: formData.get('lastSeen'),
            crime: formData.get('crime'),
            identity: formData.get('identity'),
            suspectName: formData.get('suspectName'),
            lastSeen: formData.get('lastSeen'),
            notes: formData.get('notes'),
            image: imageString,
            purgeTarget: formData.get('purgeTarget'),
            updateTarget: formData.get('updateTarget'),
            correctionDetails: formData.get('correctionDetails')
        };

        try {
            const response = await fetch(`${API_URL}/submit`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            if (response.ok) {
                document.getElementById('form-status').innerHTML = "<span style='color:var(--color-7)'>// TRANSMISSION RECEIVED -- AWAITING COUNCIL REVIEW //</span>";
                e.target.reset();
                Object.values(blocks).forEach(el => el.classList.remove('active'));
                uploadText.innerText = "[ UPLOAD BIO-SCAN IMAGE ]";
                uploadText.style.color = "inherit";
            } else {
                throw new Error("Server Error");
            }
        } catch (err) {
            document.getElementById('form-status').innerHTML = "<span style='color:var(--color-2)'>// ERROR: SECURE CONNECTION SEVERED</span>";
        } finally {
            btn.innerText = originalText;
            btn.disabled = false;
        }
    });
</script>
</body>
</html>